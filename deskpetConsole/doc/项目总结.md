# DeskPet 项目总结

## 1. 项目概览

**DeskPet** 是一个桌面轮式机器人及其配套的软硬件生态系统。本项目（`deskpetConsole`）为其核心控制台与后端服务。

项目已完成 V0.1 ~ V0.4 四个版本迭代，从 MVP 联网闭环发展为具备完整用户体系、管理后台和用户端的全栈平台。

## 2. 系统架构

```
┌─────────────────┐  ┌─────────────────┐
│   管理后台       │  │    用户端        │
│  (manager/)     │  │ (user-frontend/) │
│  Element Plus   │  │ Element Plus     │
│  端口 5173      │  │ + Vant 4         │
│                 │  │ 端口 5174        │
└────────┬────────┘  └────────┬────────┘
         │                    │
         └────────┬───────────┘
                  │ /api (Vite Proxy)
         ┌────────▼────────┐
         │    pet-core      │
         │  Spring Boot     │
         │  Sa-Token 认证   │
         │  端口 8080       │
         └────────┬────────┘
                  │
         ┌────────▼────────┐
         │  mqtt-gateway    │
         │  Vert.x MQTT    │
         └────────┬────────┘
                  │
         ┌────────▼────────┐
         │   桌宠设备       │
         └─────────────────┘
```

## 3. 版本迭代历程

### V0.1 — MVP 联网闭环 ✅

- **前端**：Vue 3 管理控制台，设备管理、指令控制、遥测面板、日志告警
- **后端**：Spring Boot REST API + Vert.x MQTT 网关
- **质量**：Vitest 单测 + Playwright E2E 测试
- **部署**：Vite 构建 + Nginx 部署指南

### V0.2 — MQTT 网关增强 ✅

- MQTT 网关可靠性增强
- 前端控制台完善
- 运维支持文档

### V0.3 — 管理后台扩展 ✅

- 授权码管理（生成、查询、撤销、导出、批次管理）
- 产品管理
- 产品物模型编辑（属性/服务/事件 CRUD）
- 后端 RBAC 权限体系（Sa-Token + 角色/权限模型）

### V0.4 — 用户体系与用户端前端 ✅

**管理后台认证接入**：
- 管理员登录页面
- 路由守卫（未登录跳转登录页）
- 401 自动跳转 + 侧边栏用户信息与退出按钮

**用户端前端（新项目）**：
- 双 UI 库适配：PC 端 Element Plus（≥768px）/ 移动端 Vant 4（<768px）
- 完整认证流程：登录、注册、路由守卫、Token 管理
- 核心页面：首页仪表盘、设备列表、设备控制（指令/遥测/事件）、激活授权码、个人中心
- 响应式布局：PC 侧边栏 / 移动端底部 TabBar

## 4. 技术栈总览

| 层级 | 技术 |
|------|------|
| 管理后台前端 | Vue 3 + TypeScript + Vite + Element Plus + Pinia + ECharts |
| 用户端前端 | Vue 3 + TypeScript + Vite + Element Plus + Vant 4 + Pinia + ECharts |
| 后端核心 | Spring Boot + JPA + Flyway + Sa-Token |
| MQTT 网关 | Vert.x MQTT |
| 数据库 | PostgreSQL（Flyway 迁移） |
| 认证 | Sa-Token（UUID Token + RBAC） |

## 5. 项目目录结构

```
deskpetConsole/
├── manager/              # 管理后台前端
│   ├── src/
│   │   ├── api/          # 管理端 API（auth, device, license, product...）
│   │   ├── pages/        # 12 个页面（Login, Dashboard, Devices...）
│   │   ├── stores/       # Pinia（user, app）
│   │   ├── router/       # 路由 + 守卫
│   │   ├── types/        # TypeScript 类型
│   │   ├── utils/        # Axios 封装
│   │   └── styles/       # 全局样式
│   └── package.json
├── user-frontend/        # 用户端前端
│   ├── src/
│   │   ├── api/          # 用户端 API（auth, user, license, device, command）
│   │   ├── pages/        # 8 个页面（Login, Register, Home, MyDevices...）
│   │   ├── layouts/      # 布局（AuthLayout, MainLayout）
│   │   ├── stores/       # Pinia（user, device）
│   │   ├── router/       # 路由 + 守卫
│   │   ├── composables/  # useResponsive, usePolling
│   │   ├── types/        # TypeScript 类型
│   │   ├── utils/        # Axios 封装 + 格式化工具
│   │   └── styles/       # 全局样式
│   └── package.json
└── doc/                  # 项目文档
    ├── 前端开发文档.md
    ├── 前端任务进度.md
    ├── 前端部署文档.md
    └── 项目总结.md
```

## 6. 后续规划

| 版本 | 方向 | 关键功能 |
|------|------|----------|
| V0.5 | 实时通信 | WebSocket/SSE 替换轮询，提升状态同步实时性 |
| V0.6 | 行为与自动化 | 行为引擎（FSM）、定时任务、行为可视化 |
| V0.7 | AI 联动 | AI 辅助操作、语音控制集成（pet-ai 模块） |
