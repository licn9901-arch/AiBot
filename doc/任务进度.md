# 任务进度

## 已完成（V0.1）
1. 初始化多模块 Maven 结构（pet-core、mqtt-gateway），包含基础依赖与构建配置。
2. pet-core：实现设备注册/查询、指令下发与状态机、遥测接收、网关回调接口（内存存储 + 超时扫描）。
3. mqtt-gateway：实现 MQTT 接入、认证、Topic ACL、上行转发、下行 HTTP 接口与在线离线回调。
4. 下发命令协议对齐：统一命令信封格式，修复遥测字段空值处理。
5. 内部接口鉴权：网关与 Core 支持可选 internal token 校验。
6. 日志框架接入：mqtt-gateway 接入 log4j2，pet-core 使用 logback，替换 System 输出为标准日志。

## 进行中
- 暂无。

## 待办（V0.1 任务清单）

### pet-core（Spring Boot）
- [ ] 接入数据库（PostgreSQL/MySQL），完成表结构设计与迁移脚本。
- [ ] 设备密钥加密存储（hash + 盐），补充注册与鉴权流程。
- [ ] 遥测/指令持久化完善（latest + 历史可选）。
- [ ] 指令超时与重试策略明确（默认不重试，可手动重试）。
- [ ] 对外 API 文档（OpenAPI/Swagger）与示例请求补充。

### mqtt-gateway（Vert.x）
- [ ] 上下行统计与连接日志完善（在线数、telemetry/ack 计数）。
- [ ] /internal/auth 与内部回调异常处理策略（超时、失败重试或降级）。
- [ ] 可观测性扩展（可选 Prometheus 指标）。

### 测试与模拟
- [ ] 设备模拟脚本（MQTT 行为：telemetry/ack/重连）。
- [ ] 协议测试（telemetry/ack）与核心状态机测试。
- [ ] 压力冒烟：连续 100 次命令下发与回执闭环验证。
- [ ] 异常场景：网关/核心重启、断网重连。

### 部署与运维
- [ ] docker-compose（DB、可选 Redis）与启动脚本。
- [ ] 环境变量与配置说明（端口、内部 token、超时参数）。
- [ ] 日志级别与输出策略（控制台/文件落盘可选）。

## 里程碑（后续未启动）
- [ ] V0.2：行为状态机 + 定时卖萌 + 触摸/碰撞等事件。
- [ ] V0.3：语音输出（TTS）。
- [ ] V0.4：Spring AI 接入（Tool Calling）。
