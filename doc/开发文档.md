# å¼€å‘æ–‡æ¡£

é€‚ç”¨èŒƒå›´ï¼šDeskPet V0.4

---

## 1. ç‰ˆæœ¬ç›®æ ‡

| ç‰ˆæœ¬ | ç›®æ ‡ | çŠ¶æ€ |
| --- | --- | --- |
| V0.1 | è®¾å¤‡ä¸Šçº¿ + ä¸‹å‘ç§»åŠ¨/åœæ­¢/è¡¨æƒ… + å›æ‰§é—­ç¯ + é¥æµ‹ä¸ŠæŠ¥ | âœ… å·²å®Œæˆ |
| V0.2 | ç”¨æˆ·ç³»ç»Ÿ + RBAC æƒé™ + æˆæƒç ç®¡ç† | âœ… å·²å®Œæˆ |
| V0.3 | ç‰©æ¨¡å‹ç®¡ç† + äº‹ä»¶ä¸ŠæŠ¥ | âœ… å·²å®Œæˆ |
| V0.4 | å‰ç«¯åˆ†ç¦»ï¼ˆç®¡ç†åå°å¢å¼º + ç”¨æˆ·ç«¯ï¼‰ | ğŸ”§ ç®¡ç†åå°å·²å®Œæˆï¼Œç”¨æˆ·ç«¯è¿›è¡Œä¸­ |
| V0.5 | å¯è§‚æµ‹æ€§å¢å¼ºï¼ˆTimescaleDB + Alertmanagerï¼‰ | è®¡åˆ’ä¸­ |
| V0.6 | è¡Œä¸ºä¸äº¤äº’ï¼ˆçŠ¶æ€æœº + å®šæ—¶å–èŒï¼‰ | è®¡åˆ’ä¸­ |

---

## 2. ä»“åº“ç»“æ„

```
deskpet/
  doc/                     # æ–‡æ¡£ç›®å½•
    MQTTé€šè®¯æ–‡æ¡£.md
    ç‰©æ¨¡å‹æ–‡æ¡£.md
    å¯¹å¤–APIæ–‡æ¡£.md
    é”™è¯¯ç æ–‡æ¡£.md
    éƒ¨ç½²ä¸è¿ç»´.md
    å¼€å‘æ–‡æ¡£.md
    ä»»åŠ¡è¿›åº¦.md
  mqtt-gateway/            # Vert.x MQTT ç½‘å…³
  pet-core/                # Spring Boot æ ¸å¿ƒæœåŠ¡
  pet-ai/                  # Spring Boot + Spring AIï¼ˆåæœŸï¼‰
  deskpetConsole/          # ç®¡ç†åå°å‰ç«¯ï¼ˆV0.4ï¼‰
  deploy/                  # éƒ¨ç½²é…ç½®
    docker-compose.yml
  scripts/                 # è„šæœ¬å·¥å…·
```

---

## 3. æŠ€æœ¯æ ˆ

### 3.1 åç«¯æŠ€æœ¯æ ˆ

| æ¨¡å— | æŠ€æœ¯ | è¯´æ˜ |
| --- | --- | --- |
| mqtt-gateway | Vert.x 4.x | MQTT Server + HTTP Server |
| pet-core | Spring Boot 3.x | REST API + JPA |
| æ•°æ®åº“ | PostgreSQL 15+ | ä¸»æ•°æ®åº“ |
| ç¼“å­˜ | Redis 7+ | ä¼šè¯å­˜å‚¨ï¼ˆSa-Tokenï¼‰ |
| æƒé™æ¡†æ¶ | Sa-Token | è®¤è¯æˆæƒ |
| æ•°æ®åº“è¿ç§» | Flyway | ç‰ˆæœ¬åŒ–è¿ç§» |
| API æ–‡æ¡£ | SpringDoc OpenAPI | Swagger UI |

### 3.2 åŸºç¡€çº¦å®š

| çº¦å®š | è¯´æ˜ |
| --- | --- |
| deviceId | è®¾å¤‡å”¯ä¸€æ ‡è¯†ï¼Œä¸ MQTT clientId/username ä¸€è‡´ |
| reqId | æŒ‡ä»¤å”¯ä¸€æ ‡è¯†ï¼ˆUUIDï¼‰ï¼Œç”¨äºå¹‚ç­‰ã€è¿½è¸ªã€å®¡è®¡ |
| schemaVersion | åè®®ç‰ˆæœ¬ï¼Œå½“å‰ä¸º 1 |
| æ—¶é—´æˆ³ | æŒ‡ä»¤/å›æ‰§/é¥æµ‹ä½¿ç”¨ç§’çº§ï¼Œäº‹ä»¶ä½¿ç”¨æ¯«ç§’çº§ |

---

## 4. MQTT Topic ä¸ ACL

### 4.1 Topic è§„èŒƒ

| æ–¹å‘ | Topic | QoS | è¯´æ˜ |
| --- | --- | --- | --- |
| è®¾å¤‡è®¢é˜… | `pet/{deviceId}/cmd` | 1 | ä¸‹è¡ŒæŒ‡ä»¤ |
| è®¾å¤‡å‘å¸ƒ | `pet/{deviceId}/telemetry` | 0 | é¥æµ‹ä¸ŠæŠ¥ |
| è®¾å¤‡å‘å¸ƒ | `pet/{deviceId}/cmd/ack` | 1 | æŒ‡ä»¤å›æ‰§ |
| è®¾å¤‡å‘å¸ƒ | `pet/{deviceId}/event` | 1 | äº‹ä»¶ä¸ŠæŠ¥ï¼ˆV0.3ï¼‰ |

### 4.2 ACL æ ¡éªŒè§„åˆ™

ç½‘å…³å¼ºåˆ¶æ ¡éªŒï¼š
- clientId == deviceId
- publish topic åªèƒ½æ˜¯ `pet/{deviceId}/telemetry`ã€`pet/{deviceId}/cmd/ack`ã€`pet/{deviceId}/event`
- subscribe topic åªèƒ½æ˜¯ `pet/{deviceId}/cmd`

---

## 5. æ¶ˆæ¯åè®®

### 5.1 å‘½ä»¤ä¿¡å°ï¼ˆCore â†’ Deviceï¼‰

```json
{
  "schemaVersion": 1,
  "type": "move",
  "reqId": "uuid",
  "ts": 1730000000,
  "payload": {
    "direction": "forward",
    "speed": 0.6,
    "durationMs": 800
  }
}
```

### 5.2 æŒ‡ä»¤ç±»å‹ï¼ˆV0.3ï¼‰

| type | è¯´æ˜ | payload å‚æ•° |
| --- | --- | --- |
| move | ç§»åŠ¨æ§åˆ¶ | direction, speed, durationMs |
| stop | åœæ­¢ | æ—  |
| setEmotion | è®¾ç½®è¡¨æƒ… | emotion |
| speak | è¯­éŸ³æ’­æŠ¥ | text, voice |
| playAnimation | æ’­æ”¾åŠ¨ç”» | animation |
| setBrightness | è®¾ç½®äº®åº¦ | brightness |
| setVolume | è®¾ç½®éŸ³é‡ | volume |
| reboot | é‡å¯è®¾å¤‡ | æ—  |

### 5.3 å›æ‰§ï¼ˆDevice â†’ Coreï¼‰

```json
{
  "schemaVersion": 1,
  "reqId": "uuid",
  "ok": true,
  "code": "DONE",
  "message": "moved forward",
  "ts": 1730000002
}
```

### 5.4 é¥æµ‹ï¼ˆDevice â†’ Coreï¼‰

```json
{
  "schemaVersion": 1,
  "ts": 1730000000,
  "battery": 87,
  "rssi": -55,
  "brightness": 80,
  "volume": 50,
  "version": "0.1.0"
}
```

### 5.5 äº‹ä»¶ï¼ˆDevice â†’ Coreï¼‰ï¼ˆV0.3 æ–°å¢ï¼‰

```json
{
  "eventId": "collision",
  "eventType": "alert",
  "timestamp": 1730000000000,
  "params": {
    "direction": "front",
    "intensity": 75
  }
}
```

---

## 6. pet-core è®¾è®¡

### 6.1 æ¨¡å—åˆ’åˆ†

| æ¨¡å— | èŒè´£ |
| --- | --- |
| DeviceService | è®¾å¤‡æ³¨å†Œã€secret ç®¡ç†ã€åœ¨çº¿çŠ¶æ€ã€é¥æµ‹æŸ¥è¯¢ |
| CommandService | æŒ‡ä»¤åˆ›å»ºã€ä¸‹å‘ã€ack å¤„ç†ã€è¶…æ—¶æ‰«æ |
| TelemetryService | é¥æµ‹å†™å…¥ latest + å†å² |
| UserService | ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç®¡ç†ï¼ˆV0.2ï¼‰ |
| LicenseCodeService | æˆæƒç ç”Ÿæˆã€æ¿€æ´»ã€æ’¤é”€ï¼ˆV0.2ï¼‰ |
| PermissionService | æƒé™/è§’è‰²æŸ¥è¯¢ï¼ˆV0.2ï¼‰ |
| ProductService | äº§å“ CRUDã€ç‰©æ¨¡å‹ç®¡ç†ï¼ˆV0.3ï¼‰ |
| DeviceEventService | äº‹ä»¶è®°å½•ã€æŸ¥è¯¢ã€ç»Ÿè®¡ï¼ˆV0.3ï¼‰ |
| GatewayClient | è°ƒç”¨ç½‘å…³ API |

### 6.2 æ•°æ®åº“è¡¨ç»“æ„

#### V1 - åŸºç¡€è¡¨

| è¡¨å | è¯´æ˜ |
| --- | --- |
| device | è®¾å¤‡ä¿¡æ¯ |
| device_session | è®¾å¤‡ä¼šè¯/åœ¨çº¿çŠ¶æ€ |
| command | æŒ‡ä»¤è®°å½• |
| telemetry_latest | æœ€æ–°é¥æµ‹ |
| telemetry_history | é¥æµ‹å†å² |

#### V2 - ç”¨æˆ·ç³»ç»Ÿ

| è¡¨å | è¯´æ˜ |
| --- | --- |
| sys_user | ç”¨æˆ·è¡¨ |
| sys_role | è§’è‰²è¡¨ |
| sys_permission | æƒé™è¡¨ |
| sys_user_role | ç”¨æˆ·-è§’è‰²å…³è” |
| sys_role_permission | è§’è‰²-æƒé™å…³è” |
| license_code | æˆæƒç è¡¨ |
| operation_log | æ“ä½œæ—¥å¿—è¡¨ |

#### V3 - ç‰©æ¨¡å‹

| è¡¨å | è¯´æ˜ |
| --- | --- |
| product | äº§å“è¡¨ |
| thing_model_property | å±æ€§å®šä¹‰ |
| thing_model_service | æœåŠ¡å®šä¹‰ |
| thing_model_event | äº‹ä»¶å®šä¹‰ |
| device_event | è®¾å¤‡äº‹ä»¶è®°å½• |

### 6.3 æŒ‡ä»¤çŠ¶æ€æœº

```
PENDING â†’ SENT â†’ ACKED/FAILED
              â†˜ TIMEOUT
```

- åˆ›å»ºï¼š`PENDING`
- ç½‘å…³ä¸‹å‘æˆåŠŸï¼š`SENT`
- æ”¶åˆ° ackï¼ˆok=trueï¼‰ï¼š`ACKED`
- æ”¶åˆ° ackï¼ˆok=falseï¼‰ï¼š`FAILED`
- è¶…æ—¶ï¼ˆé»˜è®¤ 10sï¼‰ï¼š`TIMEOUT`

### 6.4 REST API åˆ†å±‚

| å±‚çº§ | Controller | è¯´æ˜ |
| --- | --- | --- |
| å…¬å¼€ | AuthController | æ³¨å†Œã€ç™»å½•ã€é€€å‡º |
| ç”¨æˆ· | UserController | å½“å‰ç”¨æˆ·ä¿¡æ¯ã€æˆæƒç æ¿€æ´» |
| è®¾å¤‡ | DeviceController | è®¾å¤‡ CRUDã€æŒ‡ä»¤ã€äº‹ä»¶ |
| ç®¡ç† | AdminUserController | ç”¨æˆ·ç®¡ç† |
| ç®¡ç† | AdminLicenseController | æˆæƒç ç®¡ç† |
| ç®¡ç† | AdminLogController | æ“ä½œæ—¥å¿— |
| ç®¡ç† | AdminProductController | äº§å“/ç‰©æ¨¡å‹ç®¡ç† |
| å†…éƒ¨ | InternalController | ç½‘å…³å›è°ƒï¼ˆtelemetry/ack/event/presenceï¼‰ |

### 6.5 å†…éƒ¨å›è°ƒ API

| æ¥å£ | è¯´æ˜ |
| --- | --- |
| GET /internal/auth | è®¾å¤‡é‰´æƒ |
| POST /internal/telemetry/{deviceId} | é¥æµ‹ä¸ŠæŠ¥ |
| POST /internal/ack/{deviceId} | æŒ‡ä»¤å›æ‰§ |
| POST /internal/event/{deviceId} | äº‹ä»¶ä¸ŠæŠ¥ï¼ˆV0.3ï¼‰ |
| POST /internal/gateway/deviceOnline | è®¾å¤‡ä¸Šçº¿ |
| POST /internal/gateway/deviceOffline | è®¾å¤‡ç¦»çº¿ |

---

## 7. mqtt-gateway è®¾è®¡

### 7.1 èŒè´£è¾¹ç•Œ

**ç½‘å…³åªåšï¼š**
- CONNECT é‰´æƒï¼ˆè°ƒç”¨ Core /internal/authï¼‰
- åœ¨çº¿ä¼šè¯ç®¡ç†
- Topic ACL æ ¡éªŒ
- ä¸Šè¡Œè½¬å‘åˆ° Coreï¼ˆtelemetry/ack/eventï¼‰
- ä¸‹è¡Œä» Core æ¥æ”¶å¹¶è½¬å‘ç»™è®¾å¤‡

**ç½‘å…³ä¸åšï¼š**
- å¤æ‚ä¸šåŠ¡è§„åˆ™ï¼ˆåœ¨ Core åšï¼‰
- å®Œæ•´ Broker çš„è®¢é˜…è·¯ç”±ä½“ç³»

### 7.2 æ ¸å¿ƒå†…å­˜ç»“æ„

```java
Map<String, EndpointSession> sessions;

record EndpointSession(
    String deviceId,
    MqttEndpoint endpoint,
    Instant connectedAt,
    String clientIp
) {}
```

### 7.3 ä¸‹è¡Œæ¥å£

```
POST /internal/command/send
{
  "deviceId": "pet001",
  "topic": "pet/pet001/cmd",
  "qos": 1,
  "payload": "{...json...}"
}
```

### 7.4 æŒ‡æ ‡æ”¶é›†

| æŒ‡æ ‡ | è¯´æ˜ |
| --- | --- |
| onlineCount | å½“å‰åœ¨çº¿è®¾å¤‡æ•° |
| connectCount | è¿æ¥æ¬¡æ•° |
| disconnectCount | æ–­å¼€æ¬¡æ•° |
| telemetryCount | é¥æµ‹ä¸ŠæŠ¥æ¬¡æ•° |
| ackCount | å›æ‰§æ¬¡æ•° |
| eventCount | äº‹ä»¶ä¸ŠæŠ¥æ¬¡æ•°ï¼ˆV0.3ï¼‰ |
| authFailCount | é‰´æƒå¤±è´¥æ¬¡æ•° |
| callbackFailCount | å›è°ƒå¤±è´¥æ¬¡æ•° |
| commandSendCount | ä¸‹å‘è¯·æ±‚æ¬¡æ•° |

---

## 8. æƒé™ç³»ç»Ÿï¼ˆV0.2ï¼‰

### 8.1 RBAC æ¨¡å‹

```
ç”¨æˆ· â†â†’ è§’è‰² â†â†’ æƒé™
```

### 8.2 é¢„ç½®è§’è‰²

| è§’è‰² | è¯´æ˜ | æƒé™ |
| --- | --- | --- |
| ADMIN | ç®¡ç†å‘˜ | å…¨éƒ¨æƒé™ |
| USER | æ™®é€šç”¨æˆ· | è®¾å¤‡æŸ¥çœ‹/æ§åˆ¶ |
| OPERATOR | è¿ç»´äººå‘˜ | è®¾å¤‡ç®¡ç†ã€æ—¥å¿—æŸ¥çœ‹ |

### 8.3 æƒé™åˆ—è¡¨

| æƒé™ | è¯´æ˜ |
| --- | --- |
| user:* | ç”¨æˆ·ç®¡ç† |
| role:* | è§’è‰²ç®¡ç† |
| license:* | æˆæƒç ç®¡ç† |
| device:* | è®¾å¤‡ç®¡ç† |
| product:* | äº§å“ç®¡ç†ï¼ˆV0.3ï¼‰ |
| log:view | æ—¥å¿—æŸ¥çœ‹ |

### 8.4 Sa-Token é›†æˆ

- ä½¿ç”¨ Redis å­˜å‚¨ä¼šè¯
- æ”¯æŒå¹¶å‘ç™»å½•
- Token æœ‰æ•ˆæœŸ 24 å°æ—¶

---

## 9. ç‰©æ¨¡å‹ç³»ç»Ÿï¼ˆV0.3ï¼‰

### 9.1 æ¦‚å¿µæ¨¡å‹

```
äº§å“ (Product)
  â”œâ”€â”€ å±æ€§ (Property) - è®¾å¤‡çŠ¶æ€
  â”œâ”€â”€ æœåŠ¡ (Service) - å¯ä¸‹å‘æŒ‡ä»¤
  â””â”€â”€ äº‹ä»¶ (Event) - è®¾å¤‡ä¸ŠæŠ¥é€šçŸ¥
```

### 9.2 æ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ |
| --- | --- |
| INT | æ•´æ•° |
| FLOAT | æµ®ç‚¹æ•° |
| BOOL | å¸ƒå°”å€¼ |
| STRING | å­—ç¬¦ä¸² |
| ENUM | æšä¸¾ |
| STRUCT | ç»“æ„ä½“ |

### 9.3 äº‹ä»¶ç±»å‹

| ç±»å‹ | è¯´æ˜ |
| --- | --- |
| INFO | æ™®é€šä¿¡æ¯ |
| ALERT | å‘Šè­¦äº‹ä»¶ |
| ERROR | é”™è¯¯äº‹ä»¶ |

### 9.4 é»˜è®¤äº§å“

ç³»ç»Ÿåˆå§‹åŒ–åˆ›å»º `deskpet-v1` äº§å“ï¼ŒåŒ…å«ï¼š
- 5 ä¸ªå±æ€§ï¼šbattery, rssi, brightness, volume, version
- 8 ä¸ªæœåŠ¡ï¼šmove, stop, setEmotion, speak, playAnimation, setBrightness, setVolume, reboot
- 6 ä¸ªäº‹ä»¶ï¼šcollision, touch, lowBattery, fall, voiceWakeup, buttonPress

---

## 10. ç®¡ç†åå°å‰ç«¯ï¼ˆV0.4ï¼‰

### 10.1 æŠ€æœ¯æ ˆ

| æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
| --- | --- | --- |
| Vue 3 | 3.5 | Composition API + `<script setup>` |
| TypeScript | 5.9 | ç±»å‹å®‰å…¨ |
| Vue Router | 4.6 | è·¯ç”±ç®¡ç† |
| Pinia | 3.0 | çŠ¶æ€ç®¡ç† |
| Element Plus | 2.13 | UI ç»„ä»¶åº“ |
| Axios | 1.13 | HTTP å®¢æˆ·ç«¯ |
| ECharts | 6.0 | æ•°æ®å¯è§†åŒ– |
| Vite | 7.2 | æ„å»ºå·¥å…· |

### 10.2 ç›®å½•ç»“æ„

```
deskpetConsole/frontend/src/
â”œâ”€â”€ api/                    # API å±‚
â”‚   â”œâ”€â”€ device.ts          # è®¾å¤‡ç›¸å…³ API
â”‚   â”œâ”€â”€ license.ts         # æˆæƒç ç®¡ç† API
â”‚   â”œâ”€â”€ logs.ts            # æ—¥å¿—ç›¸å…³ API
â”‚   â””â”€â”€ product.ts         # äº§å“ä¸ç‰©æ¨¡å‹ API
â”œâ”€â”€ pages/                 # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ Dashboard.vue      # æ€»è§ˆ
â”‚   â”œâ”€â”€ Licenses.vue       # æˆæƒç ç®¡ç†
â”‚   â”œâ”€â”€ Products.vue       # äº§å“åˆ—è¡¨
â”‚   â”œâ”€â”€ ThingModel.vue     # ç‰©æ¨¡å‹ç¼–è¾‘
â”‚   â”œâ”€â”€ Devices.vue        # è®¾å¤‡åˆ—è¡¨
â”‚   â”œâ”€â”€ DeviceDetail.vue   # è®¾å¤‡è¯¦æƒ…
â”‚   â”œâ”€â”€ Commands.vue       # æŒ‡ä»¤ä¸‹å‘
â”‚   â”œâ”€â”€ Telemetry.vue      # é¥æµ‹æ•°æ®
â”‚   â”œâ”€â”€ Logs.vue           # æ—¥å¿—å‘Šè­¦
â”‚   â””â”€â”€ Settings.vue       # è®¾ç½®
â”œâ”€â”€ types/                 # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ api.ts             # é€šç”¨é”™è¯¯å“åº”
â”‚   â”œâ”€â”€ device.d.ts        # è®¾å¤‡ç±»å‹
â”‚   â”œâ”€â”€ license.ts         # æˆæƒç ç±»å‹
â”‚   â”œâ”€â”€ logs.ts            # æ—¥å¿—ç±»å‹
â”‚   â””â”€â”€ product.ts         # äº§å“ä¸ç‰©æ¨¡å‹ç±»å‹
â”œâ”€â”€ router/index.ts        # è·¯ç”±é…ç½®
â”œâ”€â”€ utils/request.ts       # Axios å®ä¾‹ï¼ˆè‡ªåŠ¨ Bearer Tokenï¼‰
â””â”€â”€ App.vue                # æ ¹ç»„ä»¶ï¼ˆä¾§è¾¹æ å¯¼èˆªï¼‰
```

### 10.3 è·¯ç”±è¡¨

| è·¯å¾„ | é¡µé¢ | è¯´æ˜ |
| --- | --- | --- |
| `/` | Dashboard | æ€»è§ˆ |
| `/licenses` | Licenses | æˆæƒç ç®¡ç† |
| `/products` | Products | äº§å“åˆ—è¡¨ |
| `/products/:productKey` | ThingModel | ç‰©æ¨¡å‹ç¼–è¾‘ |
| `/devices` | Devices | è®¾å¤‡åˆ—è¡¨ |
| `/devices/:id` | DeviceDetail | è®¾å¤‡è¯¦æƒ… |
| `/commands` | Commands | æŒ‡ä»¤ä¸‹å‘ |
| `/telemetry` | Telemetry | é¥æµ‹æ•°æ® |
| `/logs` | Logs | æ—¥å¿—å‘Šè­¦ |
| `/settings` | Settings | è®¾ç½® |

### 10.4 API ä»£ç†

å¼€å‘æ¨¡å¼ä¸‹ Vite å°† `/api` ä»£ç†åˆ° `http://localhost:8080`ï¼Œå‰ç«¯ API è°ƒç”¨è·¯å¾„å¦‚ `api/admin/licenses` ä¼šè¢«ä»£ç†åˆ°åç«¯ `http://localhost:8080/api/admin/licenses`ã€‚

---

## 11. æœ¬åœ°å¼€å‘

### 11.1 ç¯å¢ƒè¦æ±‚

- JDK 17+
- Maven 3.8+
- Dockerï¼ˆç”¨äº PostgreSQLã€Redisï¼‰
- Node.js 18+ï¼ˆå‰ç«¯å¼€å‘ï¼‰

### 11.2 å¯åŠ¨é¡ºåº

1. å¯åŠ¨ PostgreSQL + Redis
   ```bash
   docker compose -f deploy/docker-compose.yml --profile redis up -d
   ```

2. å¯åŠ¨ pet-core
   ```bash
   mvn -pl pet-core spring-boot:run
   ```

3. å¯åŠ¨ mqtt-gateway
   ```bash
   mvn -pl mqtt-gateway exec:java
   ```

4. è®¿é—® Swagger UI
   ```
   http://localhost:8080/swagger-ui/index.html
   ```

### 11.3 é»˜è®¤é…ç½®

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
| --- | --- | --- |
| pet-core | 8080 | REST API |
| mqtt-gateway | 1883 | MQTT |
| mqtt-gateway | 8081 | å†…éƒ¨ HTTP |
| PostgreSQL | 5432 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |

### 11.4 é»˜è®¤è´¦æˆ·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² |
| --- | --- | --- |
| admin | admin123 | ADMIN |

---

## 12. æµ‹è¯•

### 12.1 å•å…ƒæµ‹è¯•

```bash
mvn -pl pet-core test
```

### 12.2 é›†æˆæµ‹è¯•

```bash
mvn -pl pet-core verify
```

### 12.3 è®¾å¤‡æ¨¡æ‹Ÿ

ä½¿ç”¨ MQTT å®¢æˆ·ç«¯å·¥å…·ï¼ˆå¦‚ MQTTXï¼‰æ¨¡æ‹Ÿè®¾å¤‡ï¼š

1. è¿æ¥å‚æ•°
   - Host: localhost:1883
   - ClientId: pet001
   - Username: pet001
   - Password: ï¼ˆè®¾å¤‡ secretï¼‰

2. è®¢é˜… `pet/pet001/cmd`

3. å‘å¸ƒé¥æµ‹åˆ° `pet/pet001/telemetry`

4. å‘å¸ƒäº‹ä»¶åˆ° `pet/pet001/event`

---

## 13. å®‰å…¨è¦æ±‚

### 13.1 å¿…åšé¡¹

- è®¾å¤‡é‰´æƒï¼šusername=deviceId, password=secret
- å†…éƒ¨æ¥å£ï¼šé…ç½® internal.token æˆ–é™åˆ¶å†…ç½‘è®¿é—®
- Topic ACLï¼šä¸¥æ ¼æ ¡éªŒ deviceId
- å¯†ç å­˜å‚¨ï¼šBCrypt åŠ å¯†

### 13.2 ç”Ÿäº§å»ºè®®

- ä½¿ç”¨ HTTPSï¼ˆé€šè¿‡åå‘ä»£ç†ï¼‰
- ä¿®æ”¹é»˜è®¤ç®¡ç†å‘˜å¯†ç 
- é…ç½®é˜²ç«å¢™è§„åˆ™
- å¯ç”¨å®¡è®¡æ—¥å¿—

---

## 14. è¿­ä»£è·¯çº¿

| ç‰ˆæœ¬ | åŠŸèƒ½ |
| --- | --- |
| V0.4 | å‰ç«¯åˆ†ç¦»ï¼šç®¡ç†åå°å¢å¼º + ç”¨æˆ·ç«¯ |
| V0.5 | å¯è§‚æµ‹æ€§ï¼šTimescaleDB + Alertmanager |
| V0.6 | è¡Œä¸ºçŠ¶æ€æœº + å®šæ—¶å–èŒ + äº‹ä»¶è§¦å‘å“åº” |
| V0.7 | TTS è¯­éŸ³æ’­æŠ¥ |
| V0.8 | Spring AI é›†æˆï¼ˆå·¥å…·è°ƒç”¨ï¼‰ |
