# 错误码文档

## 1. 错误响应格式

对外 REST API 统一返回 `ErrorResponse`：

```json
{
  "code": "A0400",
  "message": "Invalid request",
  "details": {
    "field": "deviceId"
  }
}
```

- `code`：错误码，遵循阿里 Java 开发手册的 A/B/C + 4 位数字规范
- `message`：错误提示（英文），为空时使用默认消息
- `details`：可选，附加上下文信息

## 2. 编码规范（阿里 Java 开发手册）

- `A`：用户（客户端）错误
- `B`：系统执行出错
- `C`：调用第三方服务出错

## 3. 错误码列表（pet-core）

### 通用错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0400 | INVALID_REQUEST | 400 | Invalid request | 请求格式或参数非法 |
| A0401 | VALIDATION_FAILED | 400 | Validation failed | 参数校验失败 |
| A0402 | INVALID_PARAM | 400 | Invalid parameter | 无效参数 |

### 认证授权错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0301 | UNAUTHORIZED | 401 | Unauthorized | 未认证 |
| A0302 | INVALID_TOKEN | 401 | Invalid token | Token 无效 |
| A0303 | TOKEN_EXPIRED | 401 | Token expired | Token 已过期 |
| A0310 | FORBIDDEN | 403 | Forbidden | 禁止访问 |
| A0311 | NO_PERMISSION | 403 | No permission | 无权限 |
| A0312 | NO_ROLE | 403 | No role | 无角色 |
| A0320 | INTERNAL_TOKEN_INVALID | 401 | Invalid internal token | 内部接口鉴权失败 |

### 用户错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0404 | USER_NOT_FOUND | 404 | User not found | 用户不存在 |
| A0409 | USER_ALREADY_EXISTS | 409 | User already exists | 用户已存在 |
| A0410 | INVALID_PASSWORD | 401 | Invalid password | 密码错误 |
| A0411 | USER_DISABLED | 403 | User disabled | 用户已禁用 |

### 设备错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0420 | DEVICE_NOT_FOUND | 404 | Device not found | 设备不存在 |
| A0421 | DEVICE_ALREADY_EXISTS | 409 | Device already exists | 设备已存在 |
| A0422 | DEVICE_ALREADY_BOUND | 409 | Device already bound | 设备已被绑定 |

### 授权码错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0430 | LICENSE_NOT_FOUND | 404 | License not found | 授权码不存在 |
| A0431 | LICENSE_ALREADY_USED | 409 | License already used | 授权码已被使用 |
| A0432 | LICENSE_EXPIRED | 400 | License expired | 授权码已过期 |
| A0433 | LICENSE_REVOKED | 400 | License revoked | 授权码已撤销 |

### 指令错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0440 | COMMAND_NOT_FOUND | 404 | Command not found | 指令不存在 |
| A0441 | COMMAND_NOT_RETRYABLE | 400 | Command is not retryable | 指令当前状态不允许重试 |

### 产品/物模型错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| A0450 | PRODUCT_NOT_FOUND | 404 | Product not found | 产品不存在 |
| A0451 | PRODUCT_ALREADY_EXISTS | 409 | Product already exists | 产品已存在 |
| A0452 | PROPERTY_NOT_FOUND | 404 | Property not found | 属性不存在 |
| A0453 | PROPERTY_ALREADY_EXISTS | 409 | Property already exists | 属性已存在 |
| A0454 | SERVICE_NOT_FOUND | 404 | Service not found | 服务不存在 |
| A0455 | SERVICE_ALREADY_EXISTS | 409 | Service already exists | 服务已存在 |
| A0456 | EVENT_NOT_FOUND | 404 | Event not found | 事件不存在 |
| A0457 | EVENT_ALREADY_EXISTS | 409 | Event already exists | 事件已存在 |

### 系统错误

| 错误码 | 枚举 | HTTP 状态 | 默认消息 | 说明 |
| --- | --- | --- | --- | --- |
| B0001 | INTERNAL_ERROR | 500 | Internal server error | 系统内部异常 |
| C0001 | GATEWAY_UNAVAILABLE | 503 | Gateway unavailable | 网关不可用或调用失败 |
